<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Whispering Hands AR</title>

<script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.0/dist/aframe-extras.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

<style>
body {
  margin: 0;
  overflow: hidden;
  background: black;
  font-family: monospace;
}

#hud {
  position: fixed;
  inset: 0;
  pointer-events: none;
  background: radial-gradient(circle at center, rgba(80,0,0,0.15), rgba(0,0,0,0.85));
}
#title {
  position: absolute;
  top: 40px;
  width: 100%;
  text-align: center;
  color: #cc2222;
  font-size: 2em;
  text-shadow: 0 0 15px red;
}
#scan {
  position: absolute;
  bottom: 80px;
  width: 100%;
  text-align: center;
  color: #ff5555;
  animation: pulse 1.5s infinite;
}

@keyframes pulse {
  0% { opacity: .2; }
  50% { opacity: 1; }
  100% { opacity: .2; }
}
</style>
</head>

<body>

<div id="hud">
  <div id="title">WHISPERING HANDS</div>
  <div id="scan">Scan the sigil</div>
</div>

<a-scene
  mindar-image="imageTargetSrc: targets-3.mind;"
  vr-mode-ui="enabled: false"
  device-orientation-permission-ui="enabled: false"
>

<a-assets>
  <a-asset-item id="creature" src="angel.glb"></a-asset-item>
</a-assets>

<a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

<a-entity mindar-image-target="targetIndex: 0" horror-trigger>
  <a-gltf-model
    id="horrorModel"
    src="#creature"
    scale="0.7 0.7 0.7"
    position="0 -2.2 0"
    rotation="0 0 0"
    animation-mixer
  ></a-gltf-model>

  <a-light type="ambient" intensity="0.4"></a-light>
  <a-light type="point" intensity="1" position="0 1 1"></a-light>
</a-entity>

<script>
AFRAME.registerComponent("horror-trigger", {
  init() {
    this.last = 0;
    this.cooldown = 2500;

    const model = this.el.querySelector("#horrorModel");
    const scan = document.getElementById("scan");

    this.el.addEventListener("targetFound", () => {
      const now = Date.now();
      if (now - this.last < this.cooldown) return;
      this.last = now;

      const mixer = model.components["animation-mixer"];
      if (!mixer) return;

      mixer.stopAllAction();
      mixer.playAction();

      scan.innerText = "Manifesting...";
      setTimeout(() => scan.innerText = "Scan the sigil", 2000);
    });
  }
});
</script>

</a-scene>

</body>
</html>
