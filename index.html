<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Whispering Hands AR</title>

<script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.0/dist/aframe-extras.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

<style>
html, body {
  margin: 0;
  padding: 0;
  background: radial-gradient(circle at center, #050505, #000);
  overflow: hidden;
  font-family: monospace;
}

#overlay {
  position: fixed;
  inset: 0;
  pointer-events: none;
  background: linear-gradient(180deg, rgba(120,0,0,.15), rgba(0,0,0,.8));
  mix-blend-mode: multiply;
}
</style>
</head>

<body>

<div id="overlay"></div>

<a-scene
  mindar-image="imageTargetSrc: targets-3.mind;"
  renderer="colorManagement: true; physicallyCorrectLights: true"
  vr-mode-ui="enabled: false"
  device-orientation-permission-ui="enabled: false"
  embedded
>

  <a-assets>
    <a-asset-item id="creature" src="angel.glb"></a-asset-item>
  </a-assets>

  <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

  <a-entity mindar-image-target="targetIndex: 0" spectral-trigger>

    <a-gltf-model
      id="horrorModel"
      src="#creature"
      scale="0.7 0.7 0.7"
      position="0 -2.2 0"
      rotation="0 180 0"
      animation-mixer="clip: anim; loop: repeat"
    ></a-gltf-model>

    <a-light type="point" intensity="1.2" color="#8b0000" position="0 1 1"></a-light>
    <a-light type="ambient" intensity="0.25" color="#220000"></a-light>

  </a-entity>

<script>
AFRAME.registerComponent("spectral-trigger", {
  init() {
    this.lastActivation = 0;
    this.delay = 2500;
    const model = this.el.querySelector("#horrorModel");

    this.el.addEventListener("targetFound", () => {
      const t = performance.now();
      if (t - this.lastActivation < this.delay) return;
      this.lastActivation = t;

      const anim = model.components["animation-mixer"];
      if (!anim) return;

      anim.stopAllAction();
      anim.playAction("anim");
    });
  }
});
</script>

</a-scene>

</body>
</html>